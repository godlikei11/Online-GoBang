<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <title>Document</title>
    <style></style>
</head>
<body>
        <input type="text" id="user">
        <input type="text" id="room">
        <button id="btn"></button>
</body>
<script>
    
    let btn = document.getElementById("btn");
    let originUser = document.getElementById("user");
    let originRoom = document.getElementById("room");
    btn.addEventListener("click",function(){
    if( !originUser || !originRoom ){
        alert('请输入用户名或者房间号...')
        return;
    }
    //console.log(roomMember);
    let webSocket = new WebSocket("ws://"+document.domain+":8081");
    webSocket.onopen = function() {
        webSocket.send(JSON.stringify({
        room : originRoom.value,
        user : originUser.value
    }))
    setCookie({
                room : originRoom.value,
                user : originUser.value,
            },7);
            function setCookie(json,time){
                let data = new Date(new Date().getTime() + time*24*60*60*1000).toUTCString();
                for(let key in json){
                    document.cookie = key + "=" + json[key] + ";expires=" + data;
                }
            }

    }
    webSocket.onmessage = function(message){
        let Message = JSON.parse(message.data);
        console.log(originRoom.value)
        if(Message.room===undefined){
            console.log(Message[originRoom.value]);
            if(Message[originRoom.value][0]!==originUser.value&&Message[originRoom.value][1]!==originUser.value){
                alert("room is full")
            }
            else{
                window.location.href="index.html"//+"?room="+encodeURI(originRoom.value)+"&user="+encodeURI(originUser.value);
            }
        }
        }

})
</script>
</html>